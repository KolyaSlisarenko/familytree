<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://unpkg.com/vue@3"></script>
  <script src="familytree.js"></script>
  <title>Family tree</title>
</head>
<body>
<div id="app">
  <div style="width:100%; height: 100vh" id="tree"/>
</div>

<script>
  Vue.createApp({
    data () {
      return {
        message: 'Hello Vue!',
        users: [],
        tree: null
      };
    },

    mounted () {
      fetch('family.json').then((response) => {
        return response.json();
      })
        .then((data) => {
          this.tree = new FamilyTree(document.getElementById('tree'), {
            mouseScrool: FamilyTree.none,
            siblingSeparation: 120,
            template: 'john',
            nodeBinding: {
              field_0: 'name',
              field_1: 'age',
              img_0: 'photo'
            },
            editForm: {
              readOnly: true,
              titleBinding: "name",
              photoBinding: "photo",
              elements: [
                { type: 'textbox', label: 'Full Name', binding: 'name' },
                { type: 'textbox', label: 'Date Of Birth', binding: 'date_of_birth' },
              ]
            },
            nodes: this.mapNodes(data)
          });
        });
    },

    methods: {
      mapNodes (data) {
        return data.map(person => {
          return {
            ...person,
            name: person.name + ' ' + person.surname,
            photo: this.getPhoto(person),
            age: this.getAge(person)
          };
        });
      },

      getPhoto (person) {
        return person.photos ? ['photos', person.id, person.photos[0]].join('/') : '';
      },

      getAge (person) {
        return 1;
        // try {
        //   let dateOfDeath = new Date(person.date_of_death);
        // } catch (e) {
        //   let dateOfDeath = false;
        // }
        //
        // var d2 = d2 || new Date();
        // var diff = d2.getTime() - new Date(person.date_of_birth).getTime();
        // return Math.floor(diff / (1000 * 60 * 60 * 24 * 365.25));
      }
    }
  }).mount('#app');
</script>
</body>
</html>