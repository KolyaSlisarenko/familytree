<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="https://unpkg.com/vue@3"></script>
  <script src="familytree.js"></script>
  <title>Family tree</title>
</head>
<body>
<div id="app">
  <div style="width:100%; height: 100vh" id="tree"/>
</div>

<script>
  Vue.createApp({
    data () {
      return {
        message: 'Hello Vue!',
        users: [],
        tree: null
      };
    },

    mounted () {
      fetch('family.json').then((response) => {
        return response.json();
      })
        .then((data) => {
          this.tree = new FamilyTree(document.getElementById('tree'), {
            mouseScrool: FamilyTree.none,
            siblingSeparation: 120,
            template: 'john',
            nodeBinding: {
              field_0: 'name',
              field_1: 'age',
              img_0: 'photo'
            },
            editForm: {
              readOnly: true,
              titleBinding: 'name',
              photoBinding: 'photo',
              generateElementsFromFields: false,
              elements: [
                { type: 'textbox', label: 'Ім\'я та прізвище', binding: 'name' },
                { type: 'textbox', label: 'Дата народження', binding: 'date_of_birth' },
                { type: 'textbox', label: 'Вік', binding: 'age' },
              ]
            },
            nodes: this.mapNodes(data)
          });
        });
    },

    methods: {
      /**
       * Map persons fields for chart
       *
       * @param data
       * @returns {*}
       */
      mapNodes (data) {
        return data.map(person => {
          return {
            ...person,
            name: person.name + ' ' + person.surname,
            photo: this.getPhoto(person),
            age: this.getAge(person.date_of_birth, person.date_of_death)
          };
        });
      },

      /**
       * Person photo url
       *
       * @param person
       * @returns {string|string}
       */
      getPhoto (person) {
        return person.photos ? ['photos', person.id, person.photos[0]].join('/') : '';
      },

      /**
       * Person age
       *
       * @param startDate
       * @param endDate
       * @returns {number|string}
       */
      getAge (startDate, endDate) {
        startDate = this.parseDate(startDate);
        endDate = endDate ? this.parseDate(endDate) : new Date();

        const diff = endDate.getTime() - startDate.getTime();

        return Math.floor(diff / (1000 * 60 * 60 * 24 * 365.25)) || '';
      },

      /**
       * Parse date to default JS format
       *
       * @param date
       * @returns {Date}
       */
      parseDate (date) {
        return new Date(Date.parse(date.split('.').reverse().join('/')));
      }
    }
  }).mount('#app');
</script>
</body>
</html>